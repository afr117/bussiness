<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    body {
        font-family: Arial, sans-serif;
        margin: 40px;
        background-color: #f5f5f5;
    }
    .admin-container {
        margin-top: 30px;
    }
  </style>
</head>
<body>

  <h1>Admin Panel</h1>

  <!-- Log Out Button -->
  <form action="{{ url_for('admin_logout') }}" method="get" style="text-align:right;">
      <button type="submit">Log Out</button>
  </form>

  <div class="admin-container">
    <!-- Add New Product Form -->
    <h2>Add New Product</h2>
    {% set preset_cats = ["Buy Parts","Wheels & Tires","Electrical Components","Interior Parts"] %}
    <form action="{{ url_for('add_product') }}" method="post" enctype="multipart/form-data">
        <label>Product Name:</label><br>
        <input type="text" name="name" required><br>

        <label>Description:</label><br>
        <textarea name="description" rows="3" required></textarea><br>

        <label>Price:</label><br>
        <input type="number" name="price" step="0.01" required><br>

        <label>Category:</label><br>
        <select name="category" required>
            <option value="">Select Category</option>

            <!-- preset categories first -->
            {% for c in preset_cats %}
              <option value="{{ c }}">{{ c }}</option>
            {% endfor %}

            <!-- rest from backend, avoiding duplicates -->
            {% for c in categories %}
              {% if c not in preset_cats %}
                <option value="{{ c }}">{{ c }}</option>
              {% endif %}
            {% endfor %}
        </select><br>

        <label>Upload Image:</label><br>
        <input type="file" name="image" accept="image/*"><br><br>

        <button type="submit">Add Product</button>
    </form>

    <hr>

    <!-- Existing Products -->
    <h2>Existing Products</h2>
    {% if products %}
        <ul>
        {% for product in products %}
            <li>
                <strong>{{ product.name }}</strong> â€” ${{ product.price }}
                {% if product.category %} <em>({{ product.category }})</em> {% endif %}
                <br>
                {{ product.description }}<br>
                {% if product.image %}
                    <img src="{{ url_for('static', filename='uploads/' ~ product.image) }}" width="100"><br>
                {% endif %}

                <!-- Delete Button -->
                <form action="{{ url_for('delete_product', index=loop.index0) }}" method="post" style="display:inline">
                    <button type="submit" onclick="return confirm('Delete this product?')">Delete</button>
                </form>
            </li>
            <hr>
        {% endfor %}
        </ul>
    {% else %}
        <p>No products added yet.</p>
    {% endif %}

    <!-- Back to Home -->
    <p><a href="{{ url_for('home') }}">Back to Site</a></p>
  </div>

</body>
</html>
