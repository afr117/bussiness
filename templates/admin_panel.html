<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background-color: #f5f5f5; }
    .admin-container { margin-top: 30px; }
    input, textarea, select { padding: 6px; margin: 6px 0 12px; width: 320px; max-width: 100%; }
    button { padding: 8px 12px; }
    .muted { color:#555; font-size:13px; }
  </style>
</head>
<body>

  <h1>Admin Panel</h1>

  <form action="{{ url_for('admin_logout') }}" method="get" style="text-align:right;">
      <button type="submit">Log Out</button>
  </form>

  <div class="admin-container">
    <h2>Add New Product</h2>
    {% set preset_cats = ["Buy Parts","Wheels & Tires","Electrical Components","Interior Parts"] %}
    <form action="{{ url_for('add_product') }}" method="post" enctype="multipart/form-data">
        <label>Product Name:</label><br>
        <input type="text" name="name" required><br>

        <label>Description:</label><br>
        <textarea name="description" rows="3" required></textarea><br>

        <label>Price:</label><br>
        <input type="number" name="price" step="0.01" required><br>

        <!-- Save Y/M/M with the product -->
        <label>Year (optional):</label><br>
        <input type="text" name="year" placeholder="e.g. 2018"><br>

        <label>Make (optional):</label><br>
        <input type="text" name="make" placeholder="e.g. Toyota"><br>

        <label>Model (optional):</label><br>
        <input type="text" name="model" placeholder="e.g. Camry"><br>

        <label>Category:</label><br>
        <select name="category" required>
            <option value="">Select Category</option>
            {% for c in preset_cats %}<option value="{{ c }}">{{ c }}</option>{% endfor %}
            {% for c in categories %}
              {% if c not in preset_cats %}
                <option value="{{ c }}">{{ c }}</option>
              {% endif %}
            {% endfor %}
        </select><br>

        <label>Upload Image:</label><br>
        <input type="file" name="image" accept="image/*"><br><br>

        <button type="submit">Add Product</button>
    </form>

    <hr>

    <h2>Existing Products</h2>
    {% if products %}
        <ul>
        {% for product in products %}
            {% set price = product.get('price') %}
            <li>
                <strong>{{ product.name }}</strong>
                {% if price is not none and price != '' %} — ${{ '%.2f'|format(price|float) }}{% endif %}
                {% if product.category %} <em>({{ product.category }})</em> {% endif %}<br>

                <!-- Show Year / Make / Model if present -->
                <span class="muted">
                  {% if product.year %}Year: {{ product.year }}{% endif %}
                  {% if product.make %}{% if product.year %} • {% endif %}Make: {{ product.make }}{% endif %}
                  {% if product.model %}{% if product.year or product.make %} • {% endif %}Model: {{ product.model }}{% endif %}
                </span><br>

                {{ product.description }}<br>

                {% if product.image %}
                    <img src="{{ product.image }}" width="100" alt="product image"><br>
                {% endif %}

                <form action="{{ url_for('delete_product', index=loop.index0) }}" method="post" style="display:inline">
                    <button type="submit" onclick="return confirm('Delete this product?')">Delete</button>
                </form>
            </li>
            <hr>
        {% endfor %}
        </ul>
    {% else %}
        <p>No products added yet.</p>
    {% endif %}

    <p><a href="{{ url_for('home') }}">Back to Site</a></p>
  </div>

</body>
</html>
